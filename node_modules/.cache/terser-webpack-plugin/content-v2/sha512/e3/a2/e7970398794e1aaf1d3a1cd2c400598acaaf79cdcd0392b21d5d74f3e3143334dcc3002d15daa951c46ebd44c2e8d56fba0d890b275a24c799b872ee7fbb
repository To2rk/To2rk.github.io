{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[33],{386:function(e,a,t){\"use strict\";t.r(a);var s=t(25),r=Object(s.a)({},(function(){var e=this,a=e.$createElement,t=e._self._c||a;return t(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":e.$parent.slotKey}},[t(\"h1\",{attrs:{id:\"nextcloud安装后常见问题及解决方法\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#nextcloud安装后常见问题及解决方法\"}},[e._v(\"#\")]),e._v(\" nextcloud安装后常见问题及解决方法\")]),e._v(\" \"),t(\"blockquote\",[t(\"p\",[e._v(\"系统：CentOS 7\"),t(\"br\"),e._v(\"\\nWEB环境：LNMP搭建\")])]),e._v(\" \"),t(\"h2\",{attrs:{id:\"问题一：\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#问题一：\"}},[e._v(\"#\")]),e._v(\" \"),t(\"strong\",[e._v(\"问题一：\")])]),e._v(\" \"),t(\"p\",[t(\"code\",[e._v(\"PHP 的设置似乎有问题, 无法获取系统环境变量. 使用 getenv(\\\\”PATH\\\\”) 测试时仅返回空结果.\")])]),e._v(\" \"),t(\"p\",[e._v(\"解决方法：\")]),e._v(\" \"),t(\"ul\",[t(\"li\",[t(\"p\",[e._v(\"在PHP-FPM配置文件：\"),t(\"code\",[e._v(\"/usr/local/php/etc/php-fpm.conf\")]),e._v(\" 最后加上一句：\")]),e._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",[t(\"code\",[e._v(\" env[PATH] = /usr/local/bin:/usr/bin:/bin:/usr/local/php/bin\\n\")])])])])]),e._v(\" \"),t(\"h2\",{attrs:{id:\"问题二：\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#问题二：\"}},[e._v(\"#\")]),e._v(\" \"),t(\"strong\",[e._v(\"问题二：\")])]),e._v(\" \"),t(\"p\",[t(\"code\",[e._v('未找到 PHP 的 \"fileinfo\" 模块。强烈推荐启用该模块，从而获得更好的 MIME 类型探测结果。')])]),e._v(\" \"),t(\"p\",[e._v(\"解决方法：\")]),e._v(\" \"),t(\"h3\",{attrs:{id:\"情况一：未安装lnmp环境\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#情况一：未安装lnmp环境\"}},[e._v(\"#\")]),e._v(\" \"),t(\"strong\",[e._v(\"情况一：未安装LNMP环境\")])]),e._v(\" \"),t(\"ol\",[t(\"li\",[t(\"p\",[e._v(\"找到 \"),t(\"code\",[e._v(\"/root/lnmp1.5/include/php.sh\")]),e._v(\" 文件\")])]),e._v(\" \"),t(\"li\",[t(\"p\",[e._v(\"将\"),t(\"code\",[e._v(\"php.sh\")]),e._v(\"中的 \"),t(\"code\",[e._v(\"with_fileinfo='--disable-fileinfo'\")]),e._v(\" 改为 \"),t(\"code\",[e._v(\"with_fileinfo='--enable-fileinfo'\")])])]),e._v(\" \"),t(\"li\",[t(\"p\",[e._v(\"再执行安装脚本\")])])]),e._v(\" \"),t(\"h3\",{attrs:{id:\"情况二：已经安装了lnmp环境\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#情况二：已经安装了lnmp环境\"}},[e._v(\"#\")]),e._v(\" \"),t(\"strong\",[e._v(\"情况二：已经安装了LNMP环境\")])]),e._v(\" \"),t(\"p\",[e._v(\"LNMP1.5以上版本\")]),e._v(\" \"),t(\"ul\",[t(\"li\",[e._v(\"修改lnmp安装包目录下的 \"),t(\"code\",[e._v(\"lnmp.conf\")]),e._v(\" 文件，将\"),t(\"code\",[e._v(\"Enable_PHP_Fileinfo=’n’\")]),e._v(\" 中的n改成y保存，再执行 \"),t(\"code\",[e._v(\"./upgrade.sh php\")]),e._v(\" 升级PHP就会安装好fileinfo模块。（无论哪个版本的LNMP，建议还是使用下面这种方式，因为用这种方式把我网站都搞炸了，虽然我也不知道原因）\")])]),e._v(\" \"),t(\"p\",[e._v(\"LNMP1.4及以下\")]),e._v(\" \"),t(\"ol\",[t(\"li\",[t(\"p\",[e._v(\"解压已安装的PHP版本\")]),e._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",[t(\"code\",[e._v(\" tar -jxvf /root/lnmp1.5/src/php-7.0.30.tar.bz2\\n\")])])])]),e._v(\" \"),t(\"li\",[t(\"p\",[e._v(\"进入解压目录执行命令\")]),e._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",[t(\"code\",[e._v(\" cd /root/lnmp1.5/src/php-7.0.30/ext/fileinfo/\\n /usr/local/php/bin/phpize\\n\")])])])]),e._v(\" \"),t(\"li\",[t(\"p\",[e._v(\"编译和安装\")]),e._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",[t(\"code\",[e._v(\" ./configure --with-php-config=/usr/local/php/bin/php-config\\n make && make install\\n\")])])])]),e._v(\" \"),t(\"li\",[t(\"p\",[e._v(\"修改 \"),t(\"code\",[e._v(\"/usr/local/php/etc/\")]),e._v(\" 目录下的 \"),t(\"code\",[e._v(\"php.ini\")])]),e._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",[t(\"code\",[e._v(\" vim /usr/local/php/etc/php.ini\\n\")])])]),t(\"p\",[e._v(\"第一行加上：\")]),e._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",[t(\"code\",[e._v(' extension=\"fileinfo.so\"\\n')])])])])]),e._v(\" \"),t(\"h2\",{attrs:{id:\"问题三：\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#问题三：\"}},[e._v(\"#\")]),e._v(\" \"),t(\"strong\",[e._v(\"问题三：\")])]),e._v(\" \"),t(\"p\",[t(\"code\",[e._v(\"内存缓存未配置，为了提升使用体验，请尽量配置内存缓存\")])]),e._v(\" \"),t(\"p\",[e._v(\"解决方法：\")]),e._v(\" \"),t(\"ol\",[t(\"li\",[t(\"p\",[e._v(\"安装\"),t(\"code\",[e._v(\"APCu\")])]),e._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",[t(\"code\",[e._v(\"cd /root/lnmp1.5\\n./addons.sh install apcu\\n\")])])])]),e._v(\" \"),t(\"li\",[t(\"p\",[e._v(\"安装完成后编辑 \"),t(\"code\",[e._v(\"/home/wwwroot/cloud.yourdomain.com/config/config.php\")]),e._v(\" 文件，加上\")]),e._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",[t(\"code\",[e._v(\"'memcache.local' => '\\\\OC\\\\Memcache\\\\APCu',\\n\")])])])])]),e._v(\" \"),t(\"h2\",{attrs:{id:\"问题四：\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#问题四：\"}},[e._v(\"#\")]),e._v(\" \"),t(\"strong\",[e._v(\"问题四：\")])]),e._v(\" \"),t(\"p\",[t(\"code\",[e._v(\"PHP 的 OPcache 模块未载入。推荐开启获得更好的性能。\")])]),e._v(\" \"),t(\"p\",[e._v(\"解决方法：\")]),e._v(\" \"),t(\"ol\",[t(\"li\",[t(\"p\",[e._v(\"安装OPcahe\")]),e._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",[t(\"code\",[e._v(\"cd /root/lnmp1.5\\n./addons.sh install opcache\\n\")])])])]),e._v(\" \"),t(\"li\",[t(\"p\",[e._v(\"配置OPcahe\")])])]),e._v(\" \"),t(\"ul\",[t(\"li\",[t(\"p\",[e._v(\"LNMP1.4后，添加扩展已经不再修改php.ini，而是单独的 \"),t(\"code\",[e._v(\"/usr/local/php/conf.d/004-opcache.ini\")]),e._v(\"，nextcloud推荐配置如下\")]),e._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",[t(\"code\",[e._v('  [Zend Opcache]\\n  zend_extension=\"opcache.so\"\\n  opcache.memory_consumption=128\\n  opcache.interned_strings_buffer=8\\n  opcache.max_accelerated_files=10000\\n  opcache.revalidate_freq=1\\n  opcache.fast_shutdown=1\\n  opcache.enable_cli=1\\n  opcache.save_comments=1\\n')])])])])]),e._v(\" \"),t(\"h2\",{attrs:{id:\"问题五：\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#问题五：\"}},[e._v(\"#\")]),e._v(\" \"),t(\"strong\",[e._v(\"问题五：\")])]),e._v(\" \"),t(\"p\",[t(\"code\",[e._v(\"该实例缺失了一些推荐的PHP模块。为提高性能和兼容性，我们强烈建议安装它们。imagick\")])]),e._v(\" \"),t(\"p\",[e._v(\"解决方法：\")]),e._v(\" \"),t(\"ol\",[t(\"li\",[t(\"p\",[e._v(\"安装ImageMagick\")]),e._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",[t(\"code\",[e._v(\"yum install ImageMagick-devel\\ncd /root/lnmp1.5\\n./addons.sh install imageMagick\\n\")])])])]),e._v(\" \"),t(\"li\",[t(\"p\",[e._v(\"修改 \"),t(\"code\",[e._v(\"/usr/local/php/etc/php.ini\")]),e._v(\"，第一行加上：\")]),e._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",[t(\"code\",[e._v(' extension=\"imagick.so\"\\n')])])])])]),e._v(\" \"),t(\"h2\",{attrs:{id:\"问题六：\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#问题六：\"}},[e._v(\"#\")]),e._v(\" \"),t(\"strong\",[e._v(\"问题六：\")])]),e._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:\"https://nico.cc/files/images/screenshots/nextcloud-problem-occ-db-convert-filecache-bigint.png\",alt:\"nextcloud-problem-occ db:convert-filecache-bigint\"}})]),e._v(\" \"),t(\"p\",[e._v(\"解决方法：\")]),e._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",[t(\"code\",[e._v(\"   cd /home/wwwroot/cloud.yourdomain.com/\\n   sudo -u www php occ db:convert-filecache-bigint\\n\")])])]),t(\"ul\",[t(\"li\",[e._v(\"其中\"),t(\"code\",[e._v(\"www是网站用户名\")]),e._v(\"，视情况而定，\"),t(\"code\",[e._v(\"ls -l\")]),e._v(\" 可以查看用户名和用户组\")])]),e._v(\" \"),t(\"h3\",{attrs:{id:\"问题七：\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#问题七：\"}},[e._v(\"#\")]),e._v(\" \"),t(\"strong\",[e._v(\"问题七：\")])]),e._v(\" \"),t(\"p\",[t(\"code\",[e._v(\"PHP内存限制低于建议值512MB.\")])]),e._v(\" \"),t(\"p\",[e._v(\"解决方法：\")]),e._v(\" \"),t(\"ul\",[t(\"li\",[t(\"p\",[e._v(\"编辑 \"),t(\"code\",[e._v(\"/usr/local/php/etc/php.ini\")]),e._v(\"，将memory_limit改为512M\")]),e._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",[t(\"code\",[e._v(\"  memory_limit = 512M\\n\")])])])])]),e._v(\" \"),t(\"h2\",{attrs:{id:\"问题八：\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#问题八：\"}},[e._v(\"#\")]),e._v(\" \"),t(\"strong\",[e._v(\"问题八：\")])]),e._v(\" \"),t(\"p\",[t(\"img\",{attrs:{src:\"https://nico.cc/files/images/screenshots/nextcloud-problem-add-http-header.png\",alt:\"nextcloud-problem-add-http-header\"}}),e._v(\" \"),t(\"img\",{attrs:{src:\"https://nico.cc/files/images/screenshots/nextcloud-problem-add-http-header-no-referrer.png\",alt:\"extcloud-problem-add-http-header-no-referrer\"}})]),e._v(\" \"),t(\"p\",[e._v(\"解决方法：\")]),e._v(\" \"),t(\"ul\",[t(\"li\",[e._v(\"这五个header的问题是由重复配置造成的，在 \"),t(\"code\",[e._v(\"/usr/local/nginx/conf/vhost/cloud.yourdomain.conf\")]),e._v(\" 中把这些注释掉即可。\")])]),e._v(\" \"),t(\"h2\",{attrs:{id:\"问题九：\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#问题九：\"}},[e._v(\"#\")]),e._v(\" \"),t(\"strong\",[e._v(\"问题九：\")])]),e._v(\" \"),t(\"p\",[t(\"code\",[e._v('HTTP的请求头 \"Strict-Transport-Security\" 未设置为至少 \"15552000\" 秒. 为了提高安全性，建议参照security tips ↗中的说明启用HSTS.')])]),e._v(\" \"),t(\"p\",[e._v(\"解决方法：\")]),e._v(\" \"),t(\"ul\",[t(\"li\",[t(\"p\",[e._v(\"在 \"),t(\"code\",[e._v(\"/usr/local/nginx/conf/vhost/www.cloud.yourdomain.conf\")]),e._v(\" 中添加以下代码\")]),e._v(\" \"),t(\"div\",{staticClass:\"language- extra-class\"},[t(\"pre\",[t(\"code\",[e._v('  add_header Strict-Transport-Security \"max-age=15768000;preload;\";\\n')])])])])]),e._v(\" \"),t(\"h2\",{attrs:{id:\"问题十：\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#问题十：\"}},[e._v(\"#\")]),e._v(\" \"),t(\"strong\",[e._v(\"问题十：\")])]),e._v(\" \"),t(\"p\",[t(\"code\",[e._v(\"一些文件没有通过完整性检查。了解如何解决该问题请查看我们的 文档。(无效文件列表… / 重新扫描…)\")])]),e._v(\" \"),t(\"p\",[e._v(\"解决方法：\")]),e._v(\" \"),t(\"ul\",[t(\"li\",[e._v(\"暂时没有解决\")])]),e._v(\" \"),t(\"h2\",{attrs:{id:\"参考资料：\"}},[t(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#参考资料：\"}},[e._v(\"#\")]),e._v(\" \"),t(\"strong\",[e._v(\"参考资料：\")])]),e._v(\" \"),t(\"ul\",[t(\"li\",[e._v(\"LNMP一键环境安装Fileinfo扩展组件支持的办法：\"),t(\"a\",{attrs:{href:\"http://www.laozuo.org/11801.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"http://www.laozuo.org/11801.html\"),t(\"OutboundLink\")],1),e._v('{target=\"_blank\"}')]),e._v(\" \"),t(\"li\",[e._v(\"最新 LNMP1.5 搭建 NEXTCLOUD 私有云盘并配置 aria2c 下载：\"),t(\"a\",{attrs:{href:\"https://yalv.me/lnmp-nextcloud-aria2c/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"https://yalv.me/lnmp-nextcloud-aria2c/\"),t(\"OutboundLink\")],1),e._v('{target=\"_blank\"}')]),e._v(\" \"),t(\"li\",[e._v(\"centos安装php扩展 imagick 报错：\"),t(\"a\",{attrs:{href:\"https://www.shiqidu.com/d/367\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"https://www.shiqidu.com/d/367\"),t(\"OutboundLink\")],1),e._v('{target=\"_blank\"}')]),e._v(\" \"),t(\"li\",[e._v(\"nextcloud官方文档：\"),t(\"a\",{attrs:{href:\"https://docs.nextcloud.com/server/15/admin_manual/configuration_database/bigint_identifiers.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"https://docs.nextcloud.com/server/15/admin_manual/configuration_database/bigint_identifiers.html\"),t(\"OutboundLink\")],1),e._v('{target=\"_blank\"}')]),e._v(\" \"),t(\"li\",[e._v(\"私有云NextCould + Caddy 的快速搭建：\"),t(\"a\",{attrs:{href:\"https://canmipai.com/index.php/2018/06/29/nextcould-caddy-setup/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[e._v(\"https://canmipai.com/index.php/2018/06/29/nextcould-caddy-setup/\"),t(\"OutboundLink\")],1),e._v('{target=\"_blank\"}')])])])}),[],!1,null,null,null);a.default=r.exports}}]);","extractedComments":[]}