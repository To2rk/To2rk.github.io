{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{452:function(s,n,e){\"use strict\";e.r(n);var a=e(27),t=Object(a.a)({},(function(){var s=this,n=s.$createElement,e=s._self._c||n;return e(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":s.$parent.slotKey}},[e(\"h1\",{attrs:{id:\"nginx实现全站ssl加密及301重定向（二）\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#nginx实现全站ssl加密及301重定向（二）\"}},[s._v(\"#\")]),s._v(\" Nginx实现全站SSL加密及301重定向（二）\")]),s._v(\" \"),e(\"p\",[s._v(\"在2017年05月20日写了一篇文章记录了手动申请SSL加密证书和相关配置信息，还包括301重定向；\\n文章地址：\"),e(\"a\",{attrs:{href:\"https://nico.cc/archives/20/\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s._v(\"https://nico.cc/archives/20/\"),e(\"OutboundLink\")],1),s._v('{target=\"_blank\"}')]),s._v(\" \"),e(\"p\",[s._v(\"这篇文章将记录在\"),e(\"code\",[s._v(\"LNMP环境\")]),s._v(\"下实现SSL加密和301重定向的过程\")]),s._v(\" \"),e(\"p\",[s._v(\"如果在创建虚拟主机时没有添加SSL加密证书，使用命令 \"),e(\"code\",[s._v(\"lnmp ssl add\")]),s._v(\" 可以添加域名证书，并实现自动续期。\")]),s._v(\" \"),e(\"h2\",{attrs:{id:\"设置301重定向\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#设置301重定向\"}},[s._v(\"#\")]),s._v(\" 设置301重定向\")]),s._v(\" \"),e(\"p\",[s._v(\"在\"),e(\"code\",[s._v(\"/usr/local/nginx/conf/vhost/\")]),s._v(\"目录下找到需要配置的文件，我的配置文件如下 ，需要三个server段\")]),s._v(\" \"),e(\"h3\",{attrs:{id:\"_0x01-第一个server段-实现了http-www-920-ai和http-920-ai跳转到https-nico-cc\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_0x01-第一个server段-实现了http-www-920-ai和http-920-ai跳转到https-nico-cc\"}},[s._v(\"#\")]),s._v(\" 0x01 \"),e(\"strong\",[s._v(\"第一个server段,实现了\"),e(\"code\",[s._v(\"http://www.920.ai\")]),s._v(\"和\"),e(\"code\",[s._v(\"http://920.ai\")]),s._v(\"跳转到\"),e(\"code\",[s._v(\"https://nico.cc\")])])]),s._v(\" \"),e(\"div\",{staticClass:\"language- extra-class\"},[e(\"pre\",[e(\"code\",[s._v(\"server\\n    {\\n        listen 80;\\n        listen [::]:80;\\n        server_name www.920.ai 920.ai;\\n\\t    return 301 https://nico.cc$request_uri;\\n    }\\n\")])])]),e(\"p\",[e(\"strong\",[s._v(\"注意\")]),s._v(\"：$request_uri 为必须设置的参数\")]),s._v(\" \"),e(\"h3\",{attrs:{id:\"_0x02-第二个server段-实现了https-www-920-ai跳转到https-nico-cc\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_0x02-第二个server段-实现了https-www-920-ai跳转到https-nico-cc\"}},[s._v(\"#\")]),s._v(\" 0x02 \"),e(\"strong\",[s._v(\"第二个server段,实现了\"),e(\"code\",[s._v(\"https://www.920.ai\")]),s._v(\"跳转到\"),e(\"code\",[s._v(\"https://nico.cc\")])])]),s._v(\" \"),e(\"div\",{staticClass:\"language- line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[s._v('    server\\n    \\t{\\n    \\t    listen 443 ssl http2;\\n            listen [::]:443 ssl http2;\\n    \\t    server_name www.920.ai;\\n    \\t    return 301 https://nico.cc$request_uri;\\n    \\t    ssl on;\\n            ssl_certificate /usr/local/nginx/conf/ssl/www.920.ai/fullchain.cer;\\n            ssl_certificate_key /usr/local/nginx/conf/ssl/www.920.ai/www.920.ai.key;\\n            ssl_session_timeout 5m;\\n            ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\\n            ssl_prefer_server_ciphers on;\\n            ssl_ciphers \"EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5\"\\n           ssl_session_cache builtin:1000 shared:SSL:10m;\\n           # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048\\n           ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;\\n    \\t}\\n')])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),e(\"br\")])]),e(\"p\",[e(\"strong\",[s._v(\"注意\")]),s._v(\"：需要添加SSL相关配置信息，否则无法访问\")]),s._v(\" \"),e(\"h3\",{attrs:{id:\"_0x03-第三个server段\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_0x03-第三个server段\"}},[s._v(\"#\")]),s._v(\" 0x03 第三个server段\")]),s._v(\" \"),e(\"div\",{staticClass:\"language- line-numbers-mode\"},[e(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[e(\"code\",[s._v('    server\\n        {\\n            listen 443 ssl http2;\\n            listen [::]:443 ssl http2;\\n            server_name 920.ai;\\n            index index.html index.htm index.php default.html default.htm default.php;\\n            root  /home/wwwroot/www.920.ai;\\n            ssl on;\\n            ssl_certificate /usr/local/nginx/conf/ssl/www.920.ai/fullchain.cer;\\n            ssl_certificate_key /usr/local/nginx/conf/ssl/www.920.ai/www.920.ai.key;\\n            ssl_session_timeout 5m;\\n            ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\\n            ssl_prefer_server_ciphers on;\\n            ssl_ciphers \"EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5\";\\n            ssl_session_cache builtin:1000 shared:SSL:10m;\\n            # openssl dhparam -out /usr/local/nginx/conf/ssl/dhparam.pem 2048\\n            ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;\\n    \\n            include rewrite/typecho.conf;\\n            #error_page   404   /404.html;\\n    \\n            # Deny access to PHP files in specific directory\\n            #location ~ /(wp-content|uploads|wp-includes|images)/.*\\\\.php$ { deny all; }\\n    \\n            include enable-php-pathinfo.conf;\\n    \\n            location ~ .*\\\\.(gif|jpg|jpeg|png|bmp|swf)$\\n            {\\n                expires      30d;\\n            }\\n    \\n            location ~ .*\\\\.(js|css)?$\\n            {\\n                expires      12h;\\n            }\\n    \\n            location ~ /.well-known {\\n                allow all;\\n            }\\n    \\n            location ~ /\\\\.\\n            {\\n                deny all;\\n            }\\n    \\n            access_log  /home/wwwlogs/www.920.ai.log;\\n        }\\n')])]),s._v(\" \"),e(\"div\",{staticClass:\"line-numbers-wrapper\"},[e(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"24\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"25\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"26\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"27\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"28\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"29\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"30\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"31\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"32\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"33\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"34\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"35\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"36\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"37\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"38\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"39\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"40\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"41\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"42\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"43\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"44\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"45\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"46\")]),e(\"br\"),e(\"span\",{staticClass:\"line-number\"},[s._v(\"47\")]),e(\"br\")])]),e(\"p\",[e(\"strong\",[s._v(\"注意\")]),s._v(\"：SSL配置信息与第二段相同\")]),s._v(\" \"),e(\"h2\",{attrs:{id:\"rewrite和return两种重定向方式的区别：\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#rewrite和return两种重定向方式的区别：\"}},[s._v(\"#\")]),s._v(\" rewrite和return两种重定向方式的区别：\")]),s._v(\" \"),e(\"blockquote\",[e(\"p\",[s._v(\"第一种：使用\"),e(\"strong\",[s._v(\"rewrite\")]),s._v(\"：\"),e(\"code\",[s._v(\"rewrite ^(.*) https://nico.cc$1 permanent;\")]),e(\"br\"),s._v(\"\\n第二种：使用\"),e(\"strong\",[s._v(\"return\")]),s._v(\"： \"),e(\"code\",[s._v(\"return 301 https://nico.cc$request_uri;\")])])]),s._v(\" \"),e(\"ul\",[e(\"li\",[s._v(\"return性能更优，通过301状态码和$request_uri参数，直接告诉Nginx这是个301重定向和抓取指定URI。\")])]),s._v(\" \"),e(\"h2\",{attrs:{id:\"参考资料：\"}},[e(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#参考资料：\"}},[s._v(\"#\")]),s._v(\" 参考资料：\")]),s._v(\" \"),e(\"p\",[e(\"a\",{attrs:{href:\"http://www.yunweipai.com/archives/19328.html\",target:\"_blank\",rel:\"noopener noreferrer\"}},[s._v(\"http://www.yunweipai.com/archives/19328.html\"),e(\"OutboundLink\")],1)]),s._v(\" \"),e(\"Vssue\",{attrs:{title:s.$title}})],1)}),[],!1,null,null,null);n.default=t.exports}}]);","extractedComments":[]}