{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[75],{431:function(s,n,a){\"use strict\";a.r(n);var t=a(25),e=Object(t.a)({},(function(){var s=this,n=s.$createElement,a=s._self._c||n;return a(\"ContentSlotsDistributor\",{attrs:{\"slot-key\":s.$parent.slotKey}},[a(\"h1\",{attrs:{id:\"树莓派安装nextcloud结合frp实现外网域名访问\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#树莓派安装nextcloud结合frp实现外网域名访问\"}},[s._v(\"#\")]),s._v(\" 树莓派安装nextcloud结合frp实现外网域名访问\")]),s._v(\" \"),a(\"h2\",{attrs:{id:\"_0x00-准备工作\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_0x00-准备工作\"}},[s._v(\"#\")]),s._v(\" \"),a(\"strong\",[s._v(\"0x00 准备工作\")])]),s._v(\" \"),a(\"ul\",[a(\"li\",[s._v(\"LNMP环境\")]),s._v(\" \"),a(\"li\",[s._v(\"已经安装好nextcloud并能够正常访问，安装过程：https://nico.cc/archives/69/\")]),s._v(\" \"),a(\"li\",[s._v(\"单端口多域名，80端口访问http，443端口访问https\")]),s._v(\" \"),a(\"li\",[s._v(\"一台具有公网IP的服务器\")])]),s._v(\" \"),a(\"p\",[s._v(\"注意（可忽略，仅作为个人笔记）：\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[a(\"code\",[s._v(\"由于树莓派一般处于局域网内，因此要通过域名访问可通过修改本地host文件,然后在路由器上实现端口转发\")])]),s._v(\" \"),a(\"li\",[a(\"code\",[s._v(\"在利用LNMP添加SSL证书时,直接添加无法成功，一种解决的办法是，获取局域网公网ip，在路由器上将80端口转发到树莓派80端口（例如树莓派局域网ip为192.168.0.103），然后添加ssl证书\")])]),s._v(\" \"),a(\"li\",[a(\"code\",[s._v(\"先在服务器上添加证书，然后下载到本地\")])])]),s._v(\" \"),a(\"h2\",{attrs:{id:\"_0x01-frp安装及配置\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_0x01-frp安装及配置\"}},[s._v(\"#\")]),s._v(\" \"),a(\"strong\",[s._v(\"0x01 frp安装及配置\")])]),s._v(\" \"),a(\"ul\",[a(\"li\",[s._v(\"frp官网地址：https://github.com/fatedier/frp/releases\")]),s._v(\" \"),a(\"li\",[s._v(\"服务器上不需要安装LNMP环境\")])]),s._v(\" \"),a(\"h3\",{attrs:{id:\"服务器安装frps及配置\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#服务器安装frps及配置\"}},[s._v(\"#\")]),s._v(\" \"),a(\"strong\",[s._v(\"服务器安装frps及配置\")])]),s._v(\" \"),a(\"p\",[s._v(\"我的安装路径\"),a(\"code\",[s._v(\"/opt/frps/frps_80/\")]),s._v(\"以下是我的frps的配置\")]),s._v(\" \"),a(\"div\",{staticClass:\"language- extra-class\"},[a(\"pre\",[a(\"code\",[s._v(\"[common]\\nbind_addr = 0.0.0.0\\nbind_port = 7000\\nauth_token = 12345678\\nvhost_http_port = 80\\nvhost_https_port = 443 \\n\")])])]),a(\"h3\",{attrs:{id:\"树莓派安装frpc及配置\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#树莓派安装frpc及配置\"}},[s._v(\"#\")]),s._v(\" \"),a(\"strong\",[s._v(\"树莓派安装frpc及配置\")])]),s._v(\" \"),a(\"p\",[s._v(\"由于我是在树莓派上安装的，因此frpc选择的是ARM版本，根据相应环境选择相对应版本。\")]),s._v(\" \"),a(\"p\",[s._v(\"我的安装路径\"),a(\"code\",[s._v(\"/opt/frpc/frpc_80/\")]),s._v(\"以下是我的frps的配置\")]),s._v(\" \"),a(\"div\",{staticClass:\"language- line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[s._v(\"    [common]\\n    server_addr = 34.45.23.1\\n    server_port = 7000\\n    auth_token = 12345678\\n    log_file = /opt/frpc/frpc_80/frpc.log\\n    log_level = info\\n\\n    ＃与Aria2有关，可忽略\\n    [web1]\\n    type = http\\n    local_port = 80\\n    custom_domains = aria2.920.ai\\n    host_header_rewrite = aria2.920.ai\\n\\n    [web2]\\n    type = http\\n    local_port = 80\\n    custom_domains = pan.920.ai\\n    host_header_rewrite = pan.920.ai\\n\\n    [web3]\\n    type = https\\n    local_port = 443\\n    custom_domains = pan.920.ai\\n    host_header_rewrite = pan.920.ai\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"24\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"25\")]),a(\"br\")])]),a(\"p\",[s._v(\"注意：\")]),s._v(\" \"),a(\"ul\",[a(\"li\",[s._v(\"由于本地多个域名共用一个80端口和443端口，nginx通过http 请求中的 host 字段来确定是哪个网站，因此需要加上\"),a(\"code\",[s._v(\"host_header_rewrite\")]),s._v(\"，而 \"),a(\"code\",[s._v(\"custom_domains\")]),s._v(\"是必须的。\")])]),s._v(\" \"),a(\"h2\",{attrs:{id:\"_0x02-frp自启动\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_0x02-frp自启动\"}},[s._v(\"#\")]),s._v(\" \"),a(\"strong\",[s._v(\"0x02 frp自启动\")])]),s._v(\" \"),a(\"ul\",[a(\"li\",[s._v(\"服务器系统为CentOS\")]),s._v(\" \"),a(\"li\",[s._v(\"树莓派系统为Debian\")])]),s._v(\" \"),a(\"h3\",{attrs:{id:\"frps实现开机自启\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#frps实现开机自启\"}},[s._v(\"#\")]),s._v(\" \"),a(\"strong\",[s._v(\"frps实现开机自启\")])]),s._v(\" \"),a(\"div\",{staticClass:\"language- extra-class\"},[a(\"pre\",[a(\"code\",[s._v(\"cd /etc/init.d\\ntouch frps && chmod +x frps\\nvim frps\\n\")])])]),a(\"p\",[s._v(\"其中\"),a(\"code\",[s._v(\"frps\")]),s._v(\"的内容为\")]),s._v(\" \"),a(\"div\",{staticClass:\"language- line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[s._v(\"    #!/bin/sh\\n    ### BEGIN INIT INFO\\n    # Provides: frps\\n    # Required-Start: $network $remote_fs $local_fs\\n    # Required-Stop: $network $remote_fs $local_fs\\n    # Default-Start: 2 3 4 5\\n    # Default-Stop: 0 1 6\\n    # Short-Description: frps\\n    # Description: frp\\n    ### END INIT INFO\\n\\n    nohup /opt/frps/frps_80/./frps -c /opt/frps/frps_80/./frps.ini >/dev/null 2>&1 &\\n\\n    exit 0\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),a(\"br\")])]),a(\"p\",[s._v(\"保存并设置为开机自启\")]),s._v(\" \"),a(\"div\",{staticClass:\"language- extra-class\"},[a(\"pre\",[a(\"code\",[s._v(\"update-rc.d frps defaults\\n\")])])]),a(\"h3\",{attrs:{id:\"frpc实现开机自启\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#frpc实现开机自启\"}},[s._v(\"#\")]),s._v(\" \"),a(\"strong\",[s._v(\"frpc实现开机自启\")])]),s._v(\" \"),a(\"div\",{staticClass:\"language- extra-class\"},[a(\"pre\",[a(\"code\",[s._v(\"cd /etc/init.d\\ntouch frpc && chmod +x frpc\\nvim frpc\\n\")])])]),a(\"p\",[s._v(\"其中\"),a(\"code\",[s._v(\"frpc\")]),s._v(\"的内容为\")]),s._v(\" \"),a(\"div\",{staticClass:\"language- line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[s._v(\"    #!/bin/sh\\n    ### BEGIN INIT INFO\\n    # Provides: frpc\\n    # Required-Start: $network $remote_fs $local_fs\\n    # Required-Stop: $network $remote_fs $local_fs\\n    # Default-Start: 2 3 4 5\\n    # Default-Stop: 0 1 6\\n    # Short-Description: frpc\\n    # Description: frp\\n    ### END INIT INFO\\n\\n    nohup sleep 6;/opt/frpc/frpc_80/./frpc -c /opt/frpc/frpc_80/./frpc.ini >/dev/null 2>&1 &\\n\\n    exit 0\\n\")])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),a(\"br\")])]),a(\"p\",[s._v(\"保存并设置为开机自启\")]),s._v(\" \"),a(\"div\",{staticClass:\"language- extra-class\"},[a(\"pre\",[a(\"code\",[s._v(\"update-rc.d frpc defaults\\n\")])])]),a(\"h2\",{attrs:{id:\"_0x03-设置301重定向\"}},[a(\"a\",{staticClass:\"header-anchor\",attrs:{href:\"#_0x03-设置301重定向\"}},[s._v(\"#\")]),s._v(\" \"),a(\"strong\",[s._v(\"0x03 设置301重定向\")])]),s._v(\" \"),a(\"ul\",[a(\"li\",[s._v(\"将域名解析到服务器公网ip\")]),s._v(\" \"),a(\"li\",[s._v(\"通过域名能够访问http和https\")])]),s._v(\" \"),a(\"p\",[s._v(\"我的nginx配置路径为：\"),a(\"code\",[s._v(\"/usr/local/nginx/conf/vhost/pan.920.ai.conf\")])]),s._v(\" \"),a(\"p\",[s._v(\"其中配置为：\")]),s._v(\" \"),a(\"div\",{staticClass:\"language- line-numbers-mode\"},[a(\"pre\",{pre:!0,attrs:{class:\"language-text\"}},[a(\"code\",[s._v('    server\\n        {\\n            listen 80;\\n            listen [::]:80;\\n            server_name pan.920.ai ;\\n            return 301 https://pan.920.ai$request_uri;\\n        }\\n\\n    server\\n        {\\n            listen 443 ssl http2;\\n            listen [::]:443 ssl http2;\\n            server_name pan.920.ai ;\\n            index index.html index.htm index.php default.html default.htm default.php;\\n            root  /home/wwwroot/pan.920.ai;\\n            ssl on;\\n            ssl_certificate /usr/local/nginx/conf/ssl/pan.920.ai/fullchain.cer;\\n            ssl_certificate_key /usr/local/nginx/conf/ssl/pan.920.ai/pan.920.ai.key;\\n            ssl_session_timeout 5m;\\n            ssl_protocols TLSv1 TLSv1.1 TLSv1.2;\\n            ssl_prefer_server_ciphers on;\\n            ssl_ciphers \"EECDH+CHACHA20:EECDH+CHACHA20-draft:EECDH+AES128:RSA+AES128:EECDH+AES256:RSA+AES256:EECDH+3DES:RSA+3DES:!MD5\";\\n            ssl_session_cache builtin:1000 shared:SSL:10m;\\n            ssl_dhparam /usr/local/nginx/conf/ssl/dhparam.pem;\\n\\n            include enable-php-pathinfo.conf;\\n\\n            location ~ .*\\\\.(gif|jpg|jpeg|png|bmp|swf)$\\n            {\\n                expires      30d;\\n            }\\n\\n            location ~ .*\\\\.(js|css)?$\\n            {\\n                expires      12h;\\n            }\\n\\n            location ~ /.well-known {\\n                allow all;\\n            }\\n\\n            location ~ /\\\\.\\n            {\\n                deny all;\\n            }\\n\\n            access_log off;\\n        }\\n')])]),s._v(\" \"),a(\"div\",{staticClass:\"line-numbers-wrapper\"},[a(\"span\",{staticClass:\"line-number\"},[s._v(\"1\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"2\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"3\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"4\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"5\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"6\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"7\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"8\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"9\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"10\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"11\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"12\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"13\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"14\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"15\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"16\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"17\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"18\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"19\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"20\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"21\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"22\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"23\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"24\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"25\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"26\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"27\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"28\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"29\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"30\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"31\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"32\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"33\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"34\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"35\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"36\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"37\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"38\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"39\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"40\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"41\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"42\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"43\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"44\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"45\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"46\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"47\")]),a(\"br\"),a(\"span\",{staticClass:\"line-number\"},[s._v(\"48\")]),a(\"br\")])])])}),[],!1,null,null,null);n.default=e.exports}}]);","extractedComments":[]}